<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #888888">/*</span>
<span style="color: #888888">Breast Cancer Screening (BCS)</span>
<span style="color: #888888">*/</span>

library BCS_FHIR <span style="color: #008800; font-weight: bold">version</span> <span style="background-color: #fff0f0">&#39;1.0.0&#39;</span>

<span style="color: #008800; font-weight: bold">using</span> FHIR <span style="color: #008800; font-weight: bold">version</span> <span style="background-color: #fff0f0">&#39;3.0.0&#39;</span>

valueset <span style="color: #AA6600">&quot;Absence of Left Breast Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1329.1&#39;</span> <span style="color: #333333">//</span> ICD10CM
valueset <span style="color: #AA6600">&quot;Absence of Right Breast Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1330.2&#39;</span> <span style="color: #333333">//</span> ICD10CM

valueset <span style="color: #AA6600">&quot;Bilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1042&#39;</span> <span style="color: #333333">//</span> <span style="color: #008800; font-weight: bold">Grouping</span>
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Bilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1042.3&#39;</span> <span style="color: #333333">//</span> ICD10PCS
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Bilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;urn:oid:2.16.840.1.113883.3.464.1004.1042.4&#39;</span> <span style="color: #333333">//</span> ICD9CMProc

valueset <span style="color: #AA6600">&quot;Bilateral Modifier Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1043.5&#39;</span> <span style="color: #333333">//</span> CPT<span style="color: #333333">-</span><span style="color: #008800; font-weight: bold">Mod</span>
valueset <span style="color: #AA6600">&quot;History of Bilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1331.6&#39;</span> <span style="color: #333333">//</span> ICD10CM
valueset <span style="color: #AA6600">&quot;Left Modifier Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1148.7&#39;</span> <span style="color: #333333">//</span> CPT<span style="color: #333333">-</span><span style="color: #008800; font-weight: bold">Mod</span>

valueset <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1168&#39;</span> <span style="color: #333333">//</span> <span style="color: #008800; font-weight: bold">Grouping</span>
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1168.8&#39;</span> <span style="color: #333333">//</span> CPT
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;urn:oid:2.16.840.1.113883.3.464.1004.1168.9&#39;</span> <span style="color: #333333">//</span> HCPCS
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;urn:oid:2.16.840.1.113883.3.464.1004.1168.10&#39;</span> <span style="color: #333333">//</span> ICD9CMProc
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;urn:oid:2.16.840.1.113883.3.464.1004.1168.11&#39;</span> <span style="color: #333333">//</span> RevCode

valueset <span style="color: #AA6600">&quot;Right Modifier Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1230.12&#39;</span> <span style="color: #333333">//</span> CPT<span style="color: #333333">-</span><span style="color: #008800; font-weight: bold">Mod</span>

valueset <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1256&#39;</span> <span style="color: #333333">//</span> <span style="color: #008800; font-weight: bold">Grouping</span>
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1256.13&#39;</span> <span style="color: #333333">//</span> CPT
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;urn:oid:2.16.840.1.113883.3.464.1004.1256.14&#39;</span> <span style="color: #333333">//</span> ICD9CMProc

valueset <span style="color: #AA6600">&quot;Unilateral Mastectomy Left Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1334.15&#39;</span> <span style="color: #333333">//</span> ICD10PCS
valueset <span style="color: #AA6600">&quot;Unilateral Mastectomy Right Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1335.16&#39;</span> <span style="color: #333333">//</span> ICD10PCS

define <span style="color: #AA6600">&quot;First Predecessor Year&quot;</span>:
	<span style="color: #007020">Interval</span>[Today() <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span> years, Today() <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span> years)

define <span style="color: #AA6600">&quot;Second Predecessor Year&quot;</span>:
	<span style="color: #007020">Interval</span>[Today() <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">3</span> years, Today() <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">2</span> years)

define <span style="color: #AA6600">&quot;Third Predecessor Quarter&quot;</span>:
	<span style="color: #007020">Interval</span>[Today() <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">3</span> years <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">3</span> months, Today() <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">3</span> years)

define <span style="color: #AA6600">&quot;Lookback Interval 27 More Months&quot;</span>:
	<span style="color: #007020">Interval</span>[Today() <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">27</span> months, Today())

context Patient

define <span style="color: #AA6600">&quot;Does Patient Qualify?&quot;</span>:
	<span style="color: #AA6600">&quot;Is Female&quot;</span>
		<span style="color: #008800; font-weight: bold">and</span> <span style="color: #AA6600">&quot;Is Age 52 to 74 at End&quot;</span>
		<span style="color: #008800; font-weight: bold">and</span> if <span style="color: #AA6600">&quot;Has Double Mastectomy&quot;</span> <span style="color: #008800; font-weight: bold">is</span> <span style="color: #008800; font-weight: bold">null</span>
		        <span style="color: #008800; font-weight: bold">then</span> <span style="color: #008800; font-weight: bold">true</span>
		    <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">not</span> <span style="color: #AA6600">&quot;Has Double Mastectomy&quot;</span>

define <span style="color: #AA6600">&quot;Has Double Mastectomy&quot;</span>:
    <span style="color: #AA6600">&quot;Is Lacking Both Breasts&quot;</span>
        <span style="color: #008800; font-weight: bold">or</span> (<span style="color: #AA6600">&quot;Is Lacking Left Breast&quot;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #AA6600">&quot;Is Lacking Right Breast&quot;</span>)

define <span style="color: #AA6600">&quot;Is Female&quot;</span>:
	Patient.gender.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;female&#39;</span>

define <span style="color: #AA6600">&quot;Is Age 52 to 74 at End&quot;</span>:
	AgeInYears() <span style="color: #008800; font-weight: bold">between</span> <span style="color: #0000DD; font-weight: bold">52</span> <span style="color: #008800; font-weight: bold">and</span> <span style="color: #0000DD; font-weight: bold">74</span>

<span style="color: #888888">/*</span>
<span style="color: #888888">Administrative Specification</span>
<span style="color: #888888">*/</span>

define <span style="color: #AA6600">&quot;Needs Mammogram&quot;</span>:
	if <span style="color: #AA6600">&quot;Is Mammogram In Last 39 Months&quot;</span> <span style="color: #008800; font-weight: bold">is</span> <span style="color: #008800; font-weight: bold">null</span>
	    <span style="color: #008800; font-weight: bold">then</span> <span style="color: #008800; font-weight: bold">true</span>
	<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">not</span> <span style="color: #AA6600">&quot;Is Mammogram In Last 39 Months&quot;</span>

define <span style="color: #AA6600">&quot;Is Mammogram In Last 39 Months&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>] Proc
			<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
				<span style="color: #008800; font-weight: bold">and</span> PeriodToIntervalOfDT(Proc.performed) included <span style="color: #008800; font-weight: bold">in</span> <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Lookback Interval 27 More Months&quot;</span>
	)

define <span style="color: #AA6600">&quot;Is Lacking Both Breasts&quot;</span>:
	<span style="color: #AA6600">&quot;Is Bilateral Mastectomy&quot;</span>
		<span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is History Of Bilateral Mastectomy&quot;</span>
		<span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Bilateral Modifier&quot;</span>
		<span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Twice Spread Two Weeks&quot;</span>

define <span style="color: #AA6600">&quot;Is Lacking Left Breast&quot;</span>:
	<span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Left Modifier&quot;</span>
		<span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Left&quot;</span>
		<span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Absence Of Left Breast&quot;</span>

define <span style="color: #AA6600">&quot;Is Lacking Right Breast&quot;</span>:
	<span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Right Modifier&quot;</span>
		<span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Right&quot;</span>
		<span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Absence Of Right Breast&quot;</span>

define <span style="color: #AA6600">&quot;Is Bilateral Mastectomy&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Bilateral Mastectomy Value Set&quot;</span>] Proc
			<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
				<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> PeriodToIntervalOfDT(Proc.performed) same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
	)

define <span style="color: #AA6600">&quot;Is History Of Bilateral Mastectomy&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		[Condition: <span style="color: #AA6600">&quot;History of Bilateral Mastectomy Value Set&quot;</span>] Cond
			<span style="color: #008800; font-weight: bold">where</span> Cond.verificationStatus.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;confirmed&#39;</span>
				<span style="color: #008800; font-weight: bold">and</span> Cond.assertedDate.value same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
	)

define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Bilateral Modifier&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		[Claim] Claim
			<span style="color: #008800; font-weight: bold">where</span> Claim.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;active&#39;</span>
				<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span>(
				Claim.<span style="color: #008800; font-weight: bold">procedure</span> BbElem
					<span style="color: #008800; font-weight: bold">with</span> (
						[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] Proc
							<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
								<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> PeriodToIntervalOfDT(Proc.performed) same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
					) Proc1
						such that
							(if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
								<span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc1.identifier
								<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
					<span style="color: #008800; font-weight: bold">with</span> (
						[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Bilateral Modifier Value Set&quot;</span>] Proc
							<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
								<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> PeriodToIntervalOfDT(Proc.performed) same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
					) Proc2
						such that
							(if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
								<span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc2.identifier
								<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
			)
	)

define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Twice Spread Two Weeks&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		(
			[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] Proc
				<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
				<span style="color: #008800; font-weight: bold">return</span> PeriodToIntervalOfDT(Proc.performed)
		) WhenUM1
			<span style="color: #008800; font-weight: bold">with</span> (
				[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] Proc
					<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
					<span style="color: #008800; font-weight: bold">return</span> PeriodToIntervalOfDT(Proc.performed)
			) WhenUM2
				such that (((difference <span style="color: #008800; font-weight: bold">in</span> days <span style="color: #008800; font-weight: bold">between</span> <span style="color: #008800; font-weight: bold">start</span> <span style="color: #008800; font-weight: bold">of</span> WhenUM1 <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">start</span> <span style="color: #008800; font-weight: bold">of</span> WhenUM2) <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">14</span>)
					<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> WhenUM1 same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
					<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> WhenUM2 same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today())
	)

define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Left Modifier&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		[Claim] Claim
			<span style="color: #008800; font-weight: bold">where</span> Claim.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;active&#39;</span>
				<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span>(
				Claim.<span style="color: #008800; font-weight: bold">procedure</span> BbElem
					<span style="color: #008800; font-weight: bold">with</span> (
						[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] Proc
							<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
								<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> PeriodToIntervalOfDT(Proc.performed) same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
					) Proc1
						such that
							(if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
								<span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc1.identifier
								<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
					<span style="color: #008800; font-weight: bold">with</span> (
						[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Left Modifier Value Set&quot;</span>] Proc
							<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
								<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> PeriodToIntervalOfDT(Proc.performed) same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
					) Proc2
						such that
							(if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
								<span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc2.identifier
								<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
			)
	)

define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Left&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Left Value Set&quot;</span>] Proc
			<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
				<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> PeriodToIntervalOfDT(Proc.performed) same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
	)

define <span style="color: #AA6600">&quot;Is Absence Of Left Breast&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		[Observation: <span style="color: #AA6600">&quot;Absence of Left Breast Value Set&quot;</span>] Obs
			<span style="color: #008800; font-weight: bold">where</span> Obs.status.value <span style="color: #008800; font-weight: bold">in</span> <span style="color: #FF0000; background-color: #FFAAAA">{</span> <span style="background-color: #fff0f0">&#39;final&#39;</span>, <span style="background-color: #fff0f0">&#39;amended&#39;</span> <span style="color: #FF0000; background-color: #FFAAAA">}</span>
				<span style="color: #008800; font-weight: bold">and</span> Obs.effective.value same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
	)

define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Right Modifier&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		[Claim] Claim
			<span style="color: #008800; font-weight: bold">where</span> Claim.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;active&#39;</span>
				<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span>(
				Claim.<span style="color: #008800; font-weight: bold">procedure</span> BbElem
					<span style="color: #008800; font-weight: bold">with</span> (
						[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] Proc
							<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
								<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> PeriodToIntervalOfDT(Proc.performed) same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
					) Proc1
						such that
							(if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
								<span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc1.identifier
								<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
					<span style="color: #008800; font-weight: bold">with</span> (
						[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Right Modifier Value Set&quot;</span>] Proc
							<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
								<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> PeriodToIntervalOfDT(Proc.performed) same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
					) Proc2
						such that
							(if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
								<span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc2.identifier
								<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
			)
	)

define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Right&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		[<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Right Value Set&quot;</span>] Proc
			<span style="color: #008800; font-weight: bold">where</span> Proc.status.value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
				<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> PeriodToIntervalOfDT(Proc.performed) same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
	)

define <span style="color: #AA6600">&quot;Is Absence Of Right Breast&quot;</span>:
	<span style="color: #008800; font-weight: bold">exists</span>(
		[Observation: <span style="color: #AA6600">&quot;Absence of Right Breast Value Set&quot;</span>] Obs
			<span style="color: #008800; font-weight: bold">where</span> Obs.status.value <span style="color: #008800; font-weight: bold">in</span> <span style="color: #FF0000; background-color: #FFAAAA">{</span> <span style="background-color: #fff0f0">&#39;final&#39;</span>, <span style="background-color: #fff0f0">&#39;amended&#39;</span> <span style="color: #FF0000; background-color: #FFAAAA">}</span>
				<span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> PeriodToIntervalOfDT(Obs.effective) same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> Today()
	)

define MammogramSummary:
    <span style="background-color: #fff0f0">&#39;A Mammogram procedure for the patient is recommended&#39;</span>

define MammogramDetail:
    <span style="background-color: #fff0f0">&#39;The patient has not had a Mammogram procedure in the last 39 months&#39;</span>

define MammogramIndicator:
    <span style="background-color: #fff0f0">&#39;warning&#39;</span>

<span style="color: #888888">/*</span>
<span style="color: #888888">Utility Functions</span>
<span style="color: #888888">*/</span>

define <span style="color: #008800; font-weight: bold">function</span> PeriodToIntervalOfDT(value FHIR.Period):
	<span style="color: #007020">Interval</span>[value.<span style="color: #AA6600">&quot;start&quot;</span>.value, value.<span style="color: #AA6600">&quot;end&quot;</span>.value]

define <span style="color: #008800; font-weight: bold">function</span> CodingToCode(coding FHIR.Coding):
	<span style="color: #008800; font-weight: bold">System</span>.Code <span style="color: #FF0000; background-color: #FFAAAA">{</span>
		code: coding.code.value,
		<span style="color: #008800; font-weight: bold">system</span>: coding.<span style="color: #008800; font-weight: bold">system</span>.value,
		<span style="color: #008800; font-weight: bold">version</span>: coding.<span style="color: #008800; font-weight: bold">version</span>.value,
		display: coding.display.value
	<span style="color: #FF0000; background-color: #FFAAAA">}</span>
	<span style="color: #333333">//</span> <span style="color: #008800; font-weight: bold">From</span> FHIRHelpers
</pre></div>
