<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">library BCS_FHIR <span style="color: #008800; font-weight: bold">version</span> <span style="background-color: #fff0f0">&#39;1.0.1&#39;</span>

<span style="color: #888888">/*</span>
<span style="color: #888888">Breast Cancer Screening (BCS)</span>
<span style="color: #888888">*/</span>

<span style="color: #008800; font-weight: bold">using</span> FHIR <span style="color: #008800; font-weight: bold">version</span> <span style="background-color: #fff0f0">&#39;3.0.0&#39;</span>

include FHIRHelpers <span style="color: #008800; font-weight: bold">version</span> <span style="background-color: #fff0f0">&#39;3.0.0&#39;</span>
include Participation <span style="color: #008800; font-weight: bold">version</span> <span style="background-color: #fff0f0">&#39;1.0.0&#39;</span> <span style="color: #008800; font-weight: bold">called</span> Participation
include NCQACommon <span style="color: #008800; font-weight: bold">version</span> <span style="background-color: #fff0f0">&#39;3.10.000&#39;</span> <span style="color: #008800; font-weight: bold">called</span> Common

<span style="color: #888888">/*</span>
<span style="color: #888888">Description</span>
<span style="color: #888888">The percentage of women 50-74 years of age who had a mammogram to screen for breast cancer.</span>
<span style="color: #888888">*/</span>

valueset <span style="color: #AA6600">&quot;Absence of Left Breast Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1329.1&#39;</span> <span style="color: #333333">//</span> ICD10CM
valueset <span style="color: #AA6600">&quot;Absence of Right Breast Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1330.2&#39;</span> <span style="color: #333333">//</span> ICD10CM

valueset <span style="color: #AA6600">&quot;Bilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1042&#39;</span> <span style="color: #333333">//</span> <span style="color: #008800; font-weight: bold">Grouping</span>
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Bilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1042.3&#39;</span> <span style="color: #333333">//</span> ICD10PCS
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Bilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;urn:oid:2.16.840.1.113883.3.464.1004.1042.4&#39;</span> <span style="color: #333333">//</span> ICD9CMProc

valueset <span style="color: #AA6600">&quot;Bilateral Modifier Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1043.5&#39;</span> <span style="color: #333333">//</span> CPT<span style="color: #333333">-</span><span style="color: #008800; font-weight: bold">Mod</span>
valueset <span style="color: #AA6600">&quot;History of Bilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1331.6&#39;</span> <span style="color: #333333">//</span> ICD10CM
valueset <span style="color: #AA6600">&quot;Left Modifier Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1148.7&#39;</span> <span style="color: #333333">//</span> CPT<span style="color: #333333">-</span><span style="color: #008800; font-weight: bold">Mod</span>

valueset <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1168&#39;</span> <span style="color: #333333">//</span> <span style="color: #008800; font-weight: bold">Grouping</span>
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1168.8&#39;</span> <span style="color: #333333">//</span> CPT
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;urn:oid:2.16.840.1.113883.3.464.1004.1168.9&#39;</span> <span style="color: #333333">//</span> HCPCS
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;urn:oid:2.16.840.1.113883.3.464.1004.1168.10&#39;</span> <span style="color: #333333">//</span> ICD9CMProc
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;urn:oid:2.16.840.1.113883.3.464.1004.1168.11&#39;</span> <span style="color: #333333">//</span> RevCode

valueset <span style="color: #AA6600">&quot;Right Modifier Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1230.12&#39;</span> <span style="color: #333333">//</span> CPT<span style="color: #333333">-</span><span style="color: #008800; font-weight: bold">Mod</span>

valueset <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1256&#39;</span> <span style="color: #333333">//</span> <span style="color: #008800; font-weight: bold">Grouping</span>
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1256.13&#39;</span> <span style="color: #333333">//</span> CPT
<span style="color: #333333">//</span> valueset <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;urn:oid:2.16.840.1.113883.3.464.1004.1256.14&#39;</span> <span style="color: #333333">//</span> ICD9CMProc

valueset <span style="color: #AA6600">&quot;Unilateral Mastectomy Left Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1334.15&#39;</span> <span style="color: #333333">//</span> ICD10PCS
valueset <span style="color: #AA6600">&quot;Unilateral Mastectomy Right Value Set&quot;</span>: <span style="background-color: #fff0f0">&#39;2.16.840.1.113883.3.464.1004.1335.16&#39;</span> <span style="color: #333333">//</span> ICD10PCS

<span style="color: #888888">/*</span>
<span style="color: #888888">This library has an explicit parameter which is the product line.</span>
<span style="color: #888888">Recognized normal arguments are {&#39;commercial&#39;, &#39;medicaid&#39;, &#39;medicare&#39;}.</span>
<span style="color: #888888">If one of these normal arguments is given, the patient will only be</span>
<span style="color: #888888">considered to be in the Initial Population if they have an appropriate</span>
<span style="color: #888888">continuous enrollment in that kind of medical plan.</span>
<span style="color: #888888">If instead a null argument is given, their enrollment status will have no</span>
<span style="color: #888888">effect on whether they are considered to be in the Initial Population.</span>
<span style="color: #888888">If instead some other argument is given (an unrecognized plan type),</span>
<span style="color: #888888">the patient will unconditionally NOT be in the Initial Population.</span>
<span style="color: #888888">*/</span>

<span style="color: #008800; font-weight: bold">parameter</span> <span style="color: #AA6600">&quot;Product Line&quot;</span> String

<span style="color: #888888">/*</span>
<span style="color: #888888">This library has an explicit parameter which is the measurement year.</span>
<span style="color: #888888">While the actual parameter&#39;s type accepts all intervals, this library</span>
<span style="color: #888888">expects it will only be given arguments corresponding exactly to one whole</span>
<span style="color: #888888">calendar year, and it will not behave properly otherwise; 2017 for example:</span>
<span style="color: #888888">Interval[DateTime(2017,1,1,0,0,0,0), DateTime(2018,1,1,0,0,0,0))</span>
<span style="color: #888888">*/</span>

<span style="color: #008800; font-weight: bold">parameter</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span> <span style="color: #007020">Interval</span><span style="color: #333333">&lt;</span>DateTime<span style="color: #333333">&gt;</span>

define <span style="color: #AA6600">&quot;Lookback Interval 27 More Months&quot;</span>:
  <span style="color: #007020">Interval</span>[<span style="color: #008800; font-weight: bold">start</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span> <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">27</span> months, <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>)

<span style="color: #888888">/*</span>
<span style="color: #888888">This library evaluates with respect to exactly 1 candidate patient at a time,</span>
<span style="color: #888888">that patient being given by the special context parameter Patient.</span>
<span style="color: #888888">*/</span>

context Patient

<span style="color: #888888">/*</span>
<span style="color: #888888">Initial Population</span>
<span style="color: #888888">Product lines -- Commercial, Medicaid, Medicare (report each product line separately).</span>
<span style="color: #888888">*/</span>

define <span style="color: #AA6600">&quot;Initial Population&quot;</span>:
  <span style="color: #AA6600">&quot;Is Female&quot;</span>
    <span style="color: #008800; font-weight: bold">and</span> <span style="color: #AA6600">&quot;Is Age 52 to 74 at End&quot;</span>
    <span style="color: #008800; font-weight: bold">and</span> (<span style="color: #008800; font-weight: bold">not</span> Common.<span style="color: #AA6600">&quot;Has Hospice&quot;</span>)
    <span style="color: #008800; font-weight: bold">and</span> Participation.<span style="color: #AA6600">&quot;Is Enrolled&quot;</span>(
      <span style="color: #AA6600">&quot;Product Line&quot;</span>, 
      <span style="color: #008800; font-weight: bold">start</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>, 
      <span style="color: #007020">Interval</span>[<span style="color: #008800; font-weight: bold">start</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span> <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">27</span> months, <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>],
      <span style="color: #0000DD; font-weight: bold">45</span>
    )

define <span style="color: #AA6600">&quot;Is Female&quot;</span>:
  Patient.gender <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;female&#39;</span>

define <span style="color: #AA6600">&quot;Is Age 52 to 74 at End&quot;</span>:
  Common.CalendarAgeInYearsAt(FHIRHelpers.ToDate(Patient.birthDate), <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>) <span style="color: #008800; font-weight: bold">between</span> <span style="color: #0000DD; font-weight: bold">52</span> <span style="color: #008800; font-weight: bold">and</span> <span style="color: #0000DD; font-weight: bold">74</span>

<span style="color: #888888">/*</span>
<span style="color: #888888">Administrative Specification</span>
<span style="color: #888888">*/</span>

define <span style="color: #AA6600">&quot;Denominator&quot;</span>:
  <span style="color: #008800; font-weight: bold">true</span>

define <span style="color: #AA6600">&quot;Numerator&quot;</span>:
  <span style="color: #AA6600">&quot;Is Mammogram In Last 39 Months&quot;</span>

define <span style="color: #AA6600">&quot;Is Mammogram In Last 39 Months&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Mammography Value Set&quot;</span>] Proc
      <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> Proc.performed included <span style="color: #008800; font-weight: bold">in</span> <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Lookback Interval 27 More Months&quot;</span>
  )

define <span style="color: #AA6600">&quot;Denominator Exclusion&quot;</span>:
  (<span style="color: #AA6600">&quot;Is Lacking Both Breasts&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> (<span style="color: #AA6600">&quot;Is Lacking Left Breast&quot;</span> <span style="color: #008800; font-weight: bold">and</span> <span style="color: #AA6600">&quot;Is Lacking Right Breast&quot;</span>)
  )

define <span style="color: #AA6600">&quot;Is Lacking Both Breasts&quot;</span>:
  <span style="color: #AA6600">&quot;Is Bilateral Mastectomy&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is History Of Bilateral Mastectomy&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Bilateral Modifier&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Twice Spread Two Weeks&quot;</span>

define <span style="color: #AA6600">&quot;Is Lacking Left Breast&quot;</span>:
  <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Left Modifier&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Left&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Absence Of Left Breast&quot;</span>

define <span style="color: #AA6600">&quot;Is Lacking Right Breast&quot;</span>:
  <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Right Modifier&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Right&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Absence Of Right Breast&quot;</span>

define <span style="color: #AA6600">&quot;Is Bilateral Mastectomy&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Bilateral Mastectomy Value Set&quot;</span>] Proc
      <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> Proc.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
  )

define <span style="color: #AA6600">&quot;Is History Of Bilateral Mastectomy&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [Condition: <span style="color: #AA6600">&quot;History of Bilateral Mastectomy Value Set&quot;</span>] Cond
      <span style="color: #008800; font-weight: bold">where</span> Cond.verificationStatus <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;confirmed&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> Cond.assertedDate same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
  )

<span style="color: #888888">/*</span>
<span style="color: #888888">This approach looks only at the procedure data.</span>
<span style="color: #888888">NOTE: The Bilateral Modifier Value Set may not be appropriate for this usage</span>
<span style="color: #888888">*/</span>  
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Bilateral Modifier Procedure&quot;</span>: 
  <span style="color: #008800; font-weight: bold">exists</span> (
    [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] M
      <span style="color: #008800; font-weight: bold">where</span> M.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> M.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span> (M.bodySite B <span style="color: #008800; font-weight: bold">where</span> B <span style="color: #008800; font-weight: bold">in</span> <span style="color: #AA6600">&quot;Bilateral Modifier Value Set&quot;</span>)
  )
  
<span style="color: #888888">/*</span>
<span style="color: #888888">This approach looks only at the claim data</span>
<span style="color: #888888">*/</span>
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Bilateral Modifier Claim&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [Claim] Claim
      <span style="color: #008800; font-weight: bold">where</span> Claim.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;active&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span> (
          Claim.item Item
            <span style="color: #008800; font-weight: bold">where</span> Item.service <span style="color: #008800; font-weight: bold">in</span> <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>
              <span style="color: #008800; font-weight: bold">and</span> Item.serviced same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
              <span style="color: #008800; font-weight: bold">and</span> Item.modifier <span style="color: #008800; font-weight: bold">in</span> <span style="color: #AA6600">&quot;Bilateral Modifier Value Set&quot;</span>
          )
  )
  
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Bilateral Modifier&quot;</span>:
  <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Bilateral Modifier Claim&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Bilateral Modifier Procedure&quot;</span>

<span style="color: #888888">/*</span>
<span style="color: #888888">This approach uses the Claim linked to two procedures, one with the unilateral mastectomy code,</span>
<span style="color: #888888">and one with the bilateral modifier code.</span>
<span style="color: #888888">*/</span>
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Bilateral Modifier Claim Linked To Procedure&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [Claim] Claim
      <span style="color: #008800; font-weight: bold">where</span> Claim.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;active&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span> (
          Claim.<span style="color: #008800; font-weight: bold">procedure</span> BbElem
            <span style="color: #008800; font-weight: bold">with</span> (
              [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] Proc
                <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
                  <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> Proc.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
            ) Proc1
              such that
                (if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
                  <span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc1.identifier
                  <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
            <span style="color: #008800; font-weight: bold">with</span> (
              [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Bilateral Modifier Value Set&quot;</span>] Proc
                <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
                  <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> Proc.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
            ) Proc2
              such that
                (if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
                  <span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc2.identifier
                  <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
        )
  )

define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Twice Spread Two Weeks&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    (
      [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] Proc
        <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
        <span style="color: #008800; font-weight: bold">return</span> Proc.performed
    ) WhenUM1
      <span style="color: #008800; font-weight: bold">with</span> (
        [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] Proc
          <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
          <span style="color: #008800; font-weight: bold">return</span> Proc.performed
      ) WhenUM2
        such that (((difference <span style="color: #008800; font-weight: bold">in</span> days <span style="color: #008800; font-weight: bold">between</span> <span style="color: #008800; font-weight: bold">start</span> <span style="color: #008800; font-weight: bold">of</span> WhenUM1 <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">start</span> <span style="color: #008800; font-weight: bold">of</span> WhenUM2) <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">14</span>)
          <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> WhenUM1 same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
          <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> WhenUM2 same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>)
  )

<span style="color: #888888">/*</span>
<span style="color: #888888">This approach looks only at the procedure data.</span>
<span style="color: #888888">NOTE: The Left Modifier Value Set may not be appropriate for this usage</span>
<span style="color: #888888">*/</span>  
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Left Modifier Procedure&quot;</span>: 
  <span style="color: #008800; font-weight: bold">exists</span> (
    [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] M
      <span style="color: #008800; font-weight: bold">where</span> M.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> M.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span> (M.bodySite B <span style="color: #008800; font-weight: bold">where</span> B <span style="color: #008800; font-weight: bold">in</span> <span style="color: #AA6600">&quot;Left Modifier Value Set&quot;</span>)
  )

<span style="color: #888888">/*</span>
<span style="color: #888888">This approach looks only at the claim data</span>
<span style="color: #888888">*/</span>
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Left Modifier Claim&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [Claim] Claim
      <span style="color: #008800; font-weight: bold">where</span> Claim.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;active&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span> (
          Claim.item Item
            <span style="color: #008800; font-weight: bold">where</span> Item.service <span style="color: #008800; font-weight: bold">in</span> <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>
              <span style="color: #008800; font-weight: bold">and</span> Item.serviced same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
              <span style="color: #008800; font-weight: bold">and</span> Item.modifier <span style="color: #008800; font-weight: bold">in</span> <span style="color: #AA6600">&quot;Left Modifier Value Set&quot;</span>
          )
  )
  
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Left Modifier&quot;</span>:
  <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Left Modifier Claim&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Left Modifier Procedure&quot;</span>

<span style="color: #888888">/*</span>
<span style="color: #888888">This approach uses the Claim linked to two procedures, one with the unilateral mastectomy code,</span>
<span style="color: #888888">and one with the left modifier code.</span>
<span style="color: #888888">*/</span>
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Left Modifier Claim Linked To Procedure&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [Claim] Claim
      <span style="color: #008800; font-weight: bold">where</span> Claim.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;active&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span> (
          Claim.<span style="color: #008800; font-weight: bold">procedure</span> BbElem
            <span style="color: #008800; font-weight: bold">with</span> (
              [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] Proc
                <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
                  <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> Proc.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
            ) Proc1
              such that
                (if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
                  <span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc1.identifier
                  <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
            <span style="color: #008800; font-weight: bold">with</span> (
              [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Left Modifier Value Set&quot;</span>] Proc
                <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
                  <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> Proc.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
            ) Proc2
              such that
                (if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
                  <span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc2.identifier
                  <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
        )
  )

define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Left&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span>(
    [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Left Value Set&quot;</span>] Proc
      <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> Proc.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
  )

define <span style="color: #AA6600">&quot;Is Absence Of Left Breast&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span>(
    [Observation: <span style="color: #AA6600">&quot;Absence of Left Breast Value Set&quot;</span>] Obs
      <span style="color: #008800; font-weight: bold">where</span> Obs.status <span style="color: #008800; font-weight: bold">in</span> <span style="color: #FF0000; background-color: #FFAAAA">{</span> <span style="background-color: #fff0f0">&#39;final&#39;</span>, <span style="background-color: #fff0f0">&#39;amended&#39;</span> <span style="color: #FF0000; background-color: #FFAAAA">}</span>
        <span style="color: #008800; font-weight: bold">and</span> Obs.effective same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
  )

<span style="color: #888888">/*</span>
<span style="color: #888888">This approach looks only at the procedure data.</span>
<span style="color: #888888">NOTE: The Right Modifier Value Set may not be appropriate for this usage</span>
<span style="color: #888888">*/</span>  
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Right Modifier Procedure&quot;</span>: 
  <span style="color: #008800; font-weight: bold">exists</span> (
    [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] M
      <span style="color: #008800; font-weight: bold">where</span> M.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> M.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span> (M.bodySite B <span style="color: #008800; font-weight: bold">where</span> B <span style="color: #008800; font-weight: bold">in</span> <span style="color: #AA6600">&quot;Right Modifier Value Set&quot;</span>)
  )

<span style="color: #888888">/*</span>
<span style="color: #888888">This approach looks only at the claim data</span>
<span style="color: #888888">*/</span>
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Right Modifier Claim&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [Claim] Claim
      <span style="color: #008800; font-weight: bold">where</span> Claim.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;active&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span> (
          Claim.item Item
            <span style="color: #008800; font-weight: bold">where</span> Item.service <span style="color: #008800; font-weight: bold">in</span> <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>
              <span style="color: #008800; font-weight: bold">and</span> Item.serviced same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
              <span style="color: #008800; font-weight: bold">and</span> Item.modifier <span style="color: #008800; font-weight: bold">in</span> <span style="color: #AA6600">&quot;Right Modifier Value Set&quot;</span>
          )
  )
  
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Right Modifier&quot;</span>:
  <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Right Modifier Claim&quot;</span>
    <span style="color: #008800; font-weight: bold">or</span> <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Right Modifier Procedure&quot;</span>

<span style="color: #888888">/*</span>
<span style="color: #888888">This approach uses the Claim linked to two procedures, one with the unilateral mastectomy code,</span>
<span style="color: #888888">and one with the right modifier code.</span>
<span style="color: #888888">*/</span>
define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy With Right Modifier Claim Linked To Procedure&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [Claim] Claim
      <span style="color: #008800; font-weight: bold">where</span> Claim.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;active&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">exists</span> (
          Claim.<span style="color: #008800; font-weight: bold">procedure</span> BbElem
            <span style="color: #008800; font-weight: bold">with</span> (
              [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Value Set&quot;</span>] Proc
                <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
                  <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> Proc.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
            ) Proc1
              such that
                (if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
                  <span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc1.identifier
                  <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
            <span style="color: #008800; font-weight: bold">with</span> (
              [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Right Modifier Value Set&quot;</span>] Proc
                <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
                  <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> Proc.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
            ) Proc2
              such that
                (if BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">is</span> FHIR.Reference
                  <span style="color: #008800; font-weight: bold">then</span> (BbElem.<span style="color: #008800; font-weight: bold">procedure</span> <span style="color: #008800; font-weight: bold">as</span> FHIR.Reference).identifier <span style="color: #333333">~</span> Proc2.identifier
                  <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>)
        )
  )

define <span style="color: #AA6600">&quot;Is Unilateral Mastectomy Right&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [<span style="color: #008800; font-weight: bold">Procedure</span>: <span style="color: #AA6600">&quot;Unilateral Mastectomy Right Value Set&quot;</span>] Proc
      <span style="color: #008800; font-weight: bold">where</span> Proc.status <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;completed&#39;</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> Proc.performed same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
  )

define <span style="color: #AA6600">&quot;Is Absence Of Right Breast&quot;</span>:
  <span style="color: #008800; font-weight: bold">exists</span> (
    [Observation: <span style="color: #AA6600">&quot;Absence of Right Breast Value Set&quot;</span>] Obs
      <span style="color: #008800; font-weight: bold">where</span> Obs.status <span style="color: #008800; font-weight: bold">in</span> <span style="color: #FF0000; background-color: #FFAAAA">{</span> <span style="background-color: #fff0f0">&#39;final&#39;</span>, <span style="background-color: #fff0f0">&#39;amended&#39;</span> <span style="color: #FF0000; background-color: #FFAAAA">}</span>
        <span style="color: #008800; font-weight: bold">and</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> Obs.effective same <span style="color: #008800; font-weight: bold">day</span> <span style="color: #008800; font-weight: bold">or</span> <span style="color: #008800; font-weight: bold">before</span> <span style="color: #008800; font-weight: bold">end</span> <span style="color: #008800; font-weight: bold">of</span> <span style="color: #AA6600">&quot;Measurement Period&quot;</span>
  )
</pre></div>
